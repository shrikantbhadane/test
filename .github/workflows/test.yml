name: CI
on:
 push:
 workflow_dispatch:
 workflow_call:
  outputs:
    build-id:
      description: "The Github run-id"
      value: ${{ jobs.docker-build.outputs.output1 }}
jobs:
 compile:
  runs-on: ubuntu-latest
  steps:
  - name: checkout
    uses: actions/checkout@v3
    
 docker-build:
  needs: compile
  runs-on: ubuntu-latest
  outputs:
      output1: ${{ steps.docker-build.outputs.build-id }}
  steps:
   - name: Docker Build
     id: docker-build
     run: |
      echo "Doing docker build ${{ github.ref }}, ${{ github.event_name }}, ${{ github.event.action }}" 
      sleep 5
      docker images
      echo "Docker done GITHUB-RUNID=${{ github.run_id }}"
      echo "build-id=${{ github.run_id }}" >> $GITHUB_OUTPUT
            
 deploy-dev:
  needs: docker-build
  runs-on: ubuntu-latest
  #env:
   #build-and-verify: ${{needs.docker-build.outputs.build-id}}
  steps:
   - name: Deploy to $stage
     run: |
      echo "Deploying to Dev env."
      sleep 5
      echo "Deploying to Dev env. done "
      
      
      
